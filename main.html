<html>
    <head>

    <style>
        .small_ship
        {
            position: absolute;
            width:43mm;
            height:71mm;
            background:white;
            cursor: move;
            left: 0;
            top:0;
            transition-duration: .5s;
            transition-timing-function: ease-in-out;
        }

        .stick
        {
            position: absolute;
            width: 50px;
            height: 5.45cm;
            background: gray;
            transition-duration: .5s;
            transition-timing-function: ease-in-out;
            transform-origin: bottom;
        }

        .board
        {
            width: 91.44cm;
            height: 91.44cm;
            background: black;
            position: relative;
            zoom: 40%;
        }
    </style>

    </head>

    <body>
        <button onClick = "zoomout()"> - </button>
        <button onClick = "zoomin()"> + </button>
        <br/>
        <input type = "number" id = "speed" width = "30px" max = "4" min = "0" value = "2">
        <button onClick = "placeStick()"> Stick Left </button>
        <button onclick="moveShip()"> Move </button>
        <button onClick = "newShip()"> Ship </button>
        <div id = board class = "board">
        </div>
    </body>

    <script>	

        var zoom = 40;
        var shipNum = 0;
        var selectedShip = null;
        var yaw = [0,0,0,0]

        function zoomin()
        {   
            if(zoom < 200)
            {
                zoom += 10;
                var temp = zoom.toString() + "%";
                document.getElementById("board").style.zoom = temp;
            }
        }
        
        function zoomout()
        {   
            if(zoom > 10)
            {
                zoom -= 10;
                var temp = zoom.toString() + "%";
                document.getElementById("board").style.zoom = temp;
            }
        }

        function setSelect(ship)
        {
            selectedShip = ship;
        }

        function newShip()
        {
            var ship = document.createElement("div");
            var shipID;
            ship.classList.add("small_ship")
            shipID = "ship" + shipNum.toString();
            shipNum++;
            ship.id = shipID;
            ship.setAttribute("data-degree", "0");
            ship.onclick = function() {setSelect(this.id);};
            document.getElementById("board").appendChild(ship);
            dragElement(document.getElementById(ship.id));
        }

        function leftYaw(stickNum)
        {
            var temp = "stick" + stickNum.toString();
            var stick = document.getElementById(temp);

            if(yaw[stickNum] > -45)
            {
                var degree = yaw[stickNum] - 22.5;
                yaw[stickNum] = degree;
                stick.style.transform = "rotate(" + degree.toString() + "deg)";
            }
        }

        function rightYaw(stickNum)
        {
            var temp = "stick" + stickNum.toString();
            var stick = document.getElementById(temp);

            if(yaw[stickNum] < 45)
            {
                var degree = yaw[stickNum] + 22.5;
                yaw[stickNum] = degree;
                stick.style.transform = "rotate(" + degree.toString() + "deg)";
            }
        }

        function placeStick()
        {   
            if(selectedShip)
            {
                var num = document.getElementById("speed").value;
                temp = "stick" + num.toString();
                if(!document.getElementById(temp))
                {
                    document.getElementById("speed").disabled = true;
                    var stick = document.createElement("div");
                    var ship = document.getElementById(selectedShip);
                    var y = (ship.offsetTop * .02645833333) - 3.85;
                    var x = ship.offsetLeft - 50;
                    stick.classList.add("stick");
                    stick.style.top = y + "cm"
                    stick.style.left = x;
                    stick.id = temp;
                    document.getElementById("board").appendChild(stick);
                    var prevstick = stick;
                    num--;  
                    degree = ship.getAttribute('data-degree');
                    //yaw[0] = degree;
                    //yaw[1] = degree;
                    //yaw[2] = degree;
                    //yaw[3] = degree;

                    for(var i = num; i >= 0; i--)
                    {
                        var tempstick = document.createElement("div");
                        var buttonL = document.createElement("button");
                        var buttonR = document.createElement("button");
                        tempstick.id = "stick" + i.toString();
                        tempstick.classList.add("stick");
                        tempstick.style.top = "-5.45cm";
                        tempstick.style.left = "0px";
                        tempstick.style.transformOrigin = "bottom";
                        prevstick.appendChild(tempstick);
                        buttonL.style.marginTop = "3.85cm"
                        buttonL.textContent = "L";
                        buttonL.style.width = "25px";
                        buttonL.id = i;
                        buttonL.onclick = function() {leftYaw(this.id);};
                        tempstick.appendChild(buttonL);
                        buttonR.style.marginTop = "3.85cm"
                        buttonR.textContent = "R";
                        buttonR.style.width = "25px";
                        buttonR.id = i;
                        buttonR.onclick = function() {rightYaw(this.id);};
                        tempstick.appendChild(buttonR);
                        prevstick = tempstick;
                    }

                    document.getElementById("board").appendChild(stick);
                    placed = true;          
                }

                else
                {
                    document.getElementById("speed").disabled = false;
                    var temp = document.getElementById(temp);
                    temp.remove();
                }
            }
        }

        function moveShip()
        {          
            var ship = document.getElementById(selectedShip)
            var num = document.getElementById("speed").value;
            var shipDeg = ship.getAttribute("data-degree")
            var degree = parseFloat(shipDeg)

            for(var i = num - 1; i >= 0; i--)
            {
                degree = degree + yaw[i]
                var shipDeg = ship.getAttribute("data-degree")
                shipDeg = parseFloat(shipDeg) + degree

                var temp = ship.style.top
                var y = temp.replace("px","")
                var ybump = Math.sin(degree * Math.PI / 180) * 25
                y = parseFloat(y) + ybump
                y = y - ((5.45 * Math.cos(degree * Math.PI / 180))  / .026458333333)
                ship.style.top = y;

                var temp = ship.style.left
                var x = temp.replace("px","")
                var xbump = Math.cos(degree * Math.PI / 180) * 25
                x = parseFloat(x) + xbump
                x = x - ((5.45 * Math.sin(degree * Math.PI / 180)) / .026458333333)
                //ship.style.left = x;

                ship.setAttribute("data-degree",shipDeg)
                ship.style.transformOrigin = "left 1.6cm"
                ship.style.transform = "rotate(" + degree.toString() + "deg)"
            }
        }

        function turnLeft()
        {
            document.getElementById("ship1").style.transformOrigin = "top left";
            degree -= 45;
            var temp = "rotate(" + degree.toString() + "deg)";
            document.getElementById("ship1").style.transform = temp;
        }

        function turnRight()
        {
            document.getElementById("ship1").style.transformOrigin = "top right";
            degree += 45;
            var temp = "rotate(" + degree.toString() + "deg)";
            document.getElementById("ship1").style.transform = temp;
        }

        function dragElement(elmnt) //needs fixing
        {
            var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            elmnt.onmousedown = dragMouseDown;
            var scale
            
            function dragMouseDown(e) 
            {           
                scale = 2 - (zoom/100);
                scale = Math.pow(scale,2)
                document.getElementById(selectedShip).style.transitionDuration = "0s";
                var board = document.getElementById("board");
                e = e || window.event;
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) 
            {
                e = e || window.event;
                e.preventDefault();
                var scale = 2 - (zoom/100); //scaling of movement needs fixed
                pos1 = (pos3 - e.clientX ) * scale;
                pos2 = (pos4 - e.clientY ) * scale;
                pos3 = e.clientX //* scale;
                pos4 = e.clientY //* scale; 
                elmnt.style.top = ((elmnt.offsetTop - pos2)) + "px";
                elmnt.style.left = ((elmnt.offsetLeft - pos1)) + "px";
            }

            function closeDragElement() 
            {
                document.onmouseup = null;
                document.onmousemove = null;
            }          
        }
    </script>
</html>