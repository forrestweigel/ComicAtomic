<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    var config = {
        type: Phaser.AUTO,
        width: 1000,
        height: 720,
        cardW: 750,
        cardH: 1125,
        cardS: 0.105,
        scene: {
            preload: preload,
            create: create
        }
    };

    var game = new Phaser.Game(config);

    function preload ()
    {
        this.load.spritesheet("FFDeck", "/ComicAtomic/img/FFDeck.png", {frameWidth: config.cardW, frameHeight: config.cardH});
        this.load.image('board', '/ComicAtomic/img/board2.png'); 
        this.load.image('discard', '/ComicAtomic/img/FFLogo.png');
    }

    function create ()
    {
       this.bk = this.add.image(500,360,'board');
       this.discard = this.add.text(930, 650, '$','Arial, 32px, strong, , , , white');
       this.deck = Phaser.Utils.Array.NumberArray(0,28);
       this.hand = Array();
       this.energy = 0;

       for(x = 0; x < 5; x++)
       {
           this.hand[x] = 0;
       }
       Phaser.Utils.Array.Shuffle(this.deck);
       this.cardIdx = 0;
       fillHand(this);
    }

    function fillHand(game)
    {
        for(x = 0; x < 5; x++)
        {
            if(game.hand[x] == 0)
            {
                var card = game.add.image(0, 0, "FFDeck", game.deck[game.cardIdx]);
                var orginX = 0;
                var orginY = 0;
                card.setScale(config.cardS);
                card.angle += -90;
                game.cardIdx++;

                var spot1 = game.add.container(70, 290 + (90 * x), [ card ]);
                
                spot1.setSize(card.width * config.cardS, card.height * config.cardS);

                spot1.setInteractive();

                game.input.setDraggable(spot1);

                game.input.on('drag', function (pointer, gameObject, dragX, dragY) {

                    gameObject.x = dragX;
                    gameObject.y = dragY;
                });

                game.input.on('dragend', function (pointer, gameObject)
                {
                    if(checkOverlap(gameObject, game.discard))
                    {
                        gameObject.destroy();
                        game.energy += 1;
                        game.discard.text = game.energy;
                    }

                    else if(!checkOverlap(gameObject, game.bk))
                    {
                        gameObject.x = orginX;
                        gameObject.y = orginY;
                    }
                });

                game.input.on('dragstart', function (pointer, gameObject)
                {
                    orginX = gameObject.x;
                    orginY = gameObject.y;
                });

                game.hand[x] = 1;
            }
        }
    }

    function checkOverlap(sp1, sp2)
    {
        console.log(sp2)
        var bounds1 = sp1.getBounds();
        var bounds2 = sp2.getBounds();
        

        return Phaser.Geom.Intersects.RectangleToRectangle(bounds1, bounds2);
    }

    function update()
    {

    }

    
    </script>

</body>
</html>