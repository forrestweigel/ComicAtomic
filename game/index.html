<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>


    var config = {
        type: Phaser.AUTO,
        width: 1000,
        height: 720,
        cardW: 750,
        cardH: 1125,
        cardS: 0.105,
        scene: {
            preload: preload,
            create: create
        }
    };

    var game = new Phaser.Game(config);

    function preload ()
    {
        this.load.spritesheet("FFDeck", "/ComicAtomic/img/FFDeck.png", {frameWidth: config.cardW, frameHeight: config.cardH});
        this.load.image('board', '/ComicAtomic/img/board2.png'); 
        this.load.image('discard', '/ComicAtomic/img/FFLogo.png');
        this.load.image('logo', '/ComicAtomic/img/logo.png'); 
    }

    function create ()
    {
       this.bk = this.add.image(500,360,'board');
       this.discard = this.add.text(930, 650, '$','Arial, 80, , , , , white');
       this.deck = Phaser.Utils.Array.NumberArray(0,28);
       this.hand = Array();
       this.energy = 0;

       for(x = 0; x < 5; x++)
       {
           this.hand[x] = null;
       }

       Phaser.Utils.Array.Shuffle(this.deck);
       this.cardIdx = 0;
       fillHand(this);
       endTurnBtn(this);
    }

    function fillHand(game)
    {
        for(x = 0; x < 5; x++)
        {
            if(game.hand[x] == null)
            {
                var card = game.add.image(0, 0, "FFDeck", game.deck[game.cardIdx]);
                var orginX = 0;
                var orginY = 0;
                card.setScale(config.cardS);
                card.angle += -90;
                game.cardIdx++;

                game.hand[x] = game.add.container(70, 290 + (90 * x), [ card ]);
                
                game.hand[x].name = x;

                game.hand[x].setSize(card.width * config.cardS, card.height * config.cardS);

                game.hand[x].setInteractive();

                game.input.setDraggable(game.hand[x]);
            }
        }   

        game.input.on('drag', function (pointer, gameObject, dragX, dragY) {

            gameObject.x = dragX;
            gameObject.y = dragY;
        });

        game.input.on('dragend', function (pointer, gameObject)
        {
            if(checkOverlap(gameObject, game.discard))
            {
                gameObject.destroy();
                game.hand[gameObject.name] = null;
                game.energy += 1;
                game.discard.text = game.energy;
            }

            else if(!checkOverlap(gameObject, game.bk))
            {
                gameObject.x = orginX;
                gameObject.y = orginY;
            }
            
            else 
            {
                game.hand[gameObject.name] = null;
                gameObject.x = (120*(Math.round((gameObject.x) / 120)) - 40);
                gameObject.y = (79*(Math.round((gameObject.y) / 78)) + 4);
            }
        });

        game.input.on('dragstart', function (pointer, gameObject)
        {
            console.log(gameObject.name)
            orginX = gameObject.x;
            orginY = gameObject.y;
        });
    }

    function checkOverlap(sp1, sp2)
    {
        var bounds1 = sp1.getBounds();
        var bounds2 = sp2.getBounds();        

        return Phaser.Geom.Intersects.RectangleToRectangle(bounds1, bounds2);
    }

    function endTurnBtn(game)
    {    
        var sprite = game.add.image(0, 0, 'logo').setScale(.1);
        var endBtn = game.add.container(930, 613, [ sprite ]);
            
        endBtn.setSize(sprite.width * .1, sprite.height * .1);

        endBtn.setInteractive();

        endBtn.on('pointerover', function () {

            sprite.setTint(0x7878ff);

        });

        endBtn.on('pointerout', function () {

            sprite.clearTint();

        });

        endBtn.on('pointerdown', function () {

            console.log("werein")
            fillHand(game);

        });
    }
   
    </script>

</body>
</html>